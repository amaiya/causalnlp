---

title: Examples


keywords: fastai
sidebar: home_sidebar

summary: "Causal Inference API"
description: "Causal Inference API"
nb_path: "nbs/examples.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/examples.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">reload_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">causalnlp.causalinference</span> <span class="kn">import</span> <span class="n">CausalInferenceModel</span>
<span class="kn">from</span> <span class="nn">causalnlp.autocoder</span> <span class="kn">import</span> <span class="n">Autocoder</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-is-the-causal-impact-of-review-sentiment-on-music-prices?">What is the causal impact of review sentiment on music prices?<a class="anchor-link" href="#What-is-the-causal-impact-of-review-sentiment-on-music-prices?"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;music.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>b&#39;Skipping line 3853: expected 6 fields, saw 7\nSkipping line 11712: expected 6 fields, saw 7\nSkipping line 17594: expected 6 fields, saw 7\nSkipping line 19250: expected 6 fields, saw 7\nSkipping line 27674: expected 6 fields, saw 7\nSkipping line 28684: expected 6 fields, saw 7\nSkipping line 43109: expected 6 fields, saw 7\nSkipping line 52414: expected 6 fields, saw 7\n&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>rating</th>
      <th>product</th>
      <th>text</th>
      <th>summary</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0001388703</td>
      <td>5.0</td>
      <td>audio cd</td>
      <td>This is a great cd full of worship favorites!!...</td>
      <td>Great worship cd</td>
      <td>13.01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0001388703</td>
      <td>5.0</td>
      <td>audio cd</td>
      <td>So creative!  Love his music - the words, the ...</td>
      <td>Gotta listen to this!</td>
      <td>13.01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0001388703</td>
      <td>5.0</td>
      <td>audio cd</td>
      <td>Keith Green, gone far to early in his carreer,...</td>
      <td>Great approach still gets the message out</td>
      <td>13.01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0001388703</td>
      <td>5.0</td>
      <td>audio cd</td>
      <td>Keith Green had his special comedy style of Ch...</td>
      <td>Great A must have</td>
      <td>13.01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0001388703</td>
      <td>5.0</td>
      <td>audio cd</td>
      <td>Keith Green / So you wanna go back to Egypt......</td>
      <td>A great one from Keith with a guest appearance...</td>
      <td>13.01</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;full_text&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0        Great worship cd - This is a great cd full of ...
1        Gotta listen to this! - So creative!  Love his...
2        Great approach still gets the message out - Ke...
3        Great A must have - Keith Green had his specia...
4        A great one from Keith with a guest appearance...
                               ...                        
55976    Crunching the numbers - I can easily recommend...
55977    Fresh piano sounds from established Glass comp...
55978    Bad sonics - Batagov is a masterful player of ...
55979    Great solo piano - I always like to hear Phili...
55980    An excellent choice of pieces covering the hig...
Name: full_text, Length: 55981, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">CausalInferenceModel</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">treatment_col</span><span class="o">=</span><span class="s1">&#39;treatment&#39;</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">text_col</span><span class="o">=</span><span class="s1">&#39;full_text&#39;</span><span class="p">,</span>
                         <span class="n">ignore_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">])</span>
<span class="n">cm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>outcome column (numerical): price
treatment column: treatment
numerical/categorical covariates: [&#39;product&#39;]
text covariate: full_text
preprocess time:  3.048341751098633  sec
start fitting causal inference model
time to fit causal inference model:  3.513471841812134  sec
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 2.1172464103123447}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

