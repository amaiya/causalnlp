---

title: Causal Inference


keywords: fastai
sidebar: home_sidebar

summary: "Causal Inference API"
description: "Causal Inference API"
nb_path: "nbs/00_causalinference.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_causalinference.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CausalInferenceModel" class="doc_header"><code>class</code> <code>CausalInferenceModel</code><a href="https://github.com/amaiya/causalnlp/tree/main/causalnlp/causalinference.py#L40" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CausalInferenceModel</code>(<strong><code>df</code></strong>, <strong><code>method</code></strong>=<em><code>'t-learner'</code></em>, <strong><code>metalearner_type</code></strong>=<em><code>None</code></em>, <strong><code>treatment_col</code></strong>=<em><code>'treatment'</code></em>, <strong><code>outcome_col</code></strong>=<em><code>'outcome'</code></em>, <strong><code>text_col</code></strong>=<em><code>None</code></em>, <strong><code>ignore_cols</code></strong>=<em><code>[]</code></em>, <strong><code>include_cols</code></strong>=<em><code>[]</code></em>, <strong><code>treatment_effect_col</code></strong>=<em><code>'treatment_effect'</code></em>, <strong><code>learner</code></strong>=<em><code>None</code></em>, <strong><code>effect_learner</code></strong>=<em><code>None</code></em>, <strong><code>min_df</code></strong>=<em><code>0.05</code></em>, <strong><code>max_df</code></strong>=<em><code>0.5</code></em>, <strong><code>ngram_range</code></strong>=<em><code>(1, 1)</code></em>, <strong><code>stop_words</code></strong>=<em><code>'english'</code></em>, <strong><code>verbose</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Infers causality from the data contained in <code>df</code> using a metalearner.</p>
<p>Usage:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">cm</span> <span class="o">=</span> <span class="n">CausalInferenceModel</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                              <span class="n">treatment_col</span><span class="o">=</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">,</span>
                              <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">,</span> <span class="n">text_col</span><span class="o">=</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">,</span>
                              <span class="n">ignore_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">])</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>df</strong> : pandas.DataFrame containing dataset</li>
<li><strong>method</strong> : metalearner model to use. One of {'t-learner', 's-learner', 'x-learner', 'r-learner'} (Default: 't-learner')</li>
<li><strong>metalearner_type</strong> : Alias of <code>method</code> for backwards compatibility. Overrides <code>method</code> if not None.</li>
<li><strong>treatment_col</strong> : treatment variable; column should contain binary values: 1 for treated, 0 for untreated.</li>
<li><strong>outcome_col</strong> : outcome variable; column should contain the categorical or numeric outcome values</li>
<li><strong>text_col</strong> : (optional) text column containing the strings (e.g., articles, reviews, emails).</li>
<li><strong>ignore_cols</strong> : columns to ignore in the analysis</li>
<li><strong>include_cols</strong> : columns to include as covariates (e.g., possible confounders)</li>
<li><strong>treatment_effect_col</strong> : name of column to hold causal effect estimations.  Does not need to exist.  Created by CausalNLP.</li>
<li><strong>learner</strong> : an instance of a custom learner.  If None, Log/Lin Regression is used for S-Learner
<pre><code>          and a default LightGBM model will be used for all other metalearner types.
</code></pre>
  # Example
   learner = LGBMClassifier(num_leaves=1000)</li>
<li><strong>effect_learner</strong>: used for x-learner/r-learner and must be regression model</li>
<li><strong>min_df</strong> : min_df parameter used for text processing using sklearn</li>
<li><strong>max_df</strong> : max_df parameter used for text procesing using sklearn</li>
<li><strong>ngram_range</strong>: ngrams used for text vectorization. default: (1,1)</li>
<li><strong>stop_words</strong> : stop words used for text processing (from sklearn)</li>
<li><strong>verbose</strong> : If 1, print informational messages.  If 0, suppress.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.fit" class="doc_header"><code>CausalInferenceModel.fit</code><a href="__main__.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.fit</code>(<strong><code>p</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Fits a causal inference model and estimates outcome
with and without treatment for each observation.
For X-Learner and R-Learner, propensity scores will be computed
using default propensity model unless <code>p</code> is not None.
Parameter <code>p</code> is not used for other methods.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.tune_and_use_default_learner" class="doc_header"><code>CausalInferenceModel.tune_and_use_default_learner</code><a href="__main__.py#L363" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.tune_and_use_default_learner</code>(<strong><code>split_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>random_state</code></strong>=<em><code>314</code></em>, <strong><code>scoring</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Tunes the hyperparameters of a default LightGBM model, replaces <a href="/causalnlp/causalinference.html#CausalInferenceModel.learner"><code>CausalInferenceModel.learner</code></a>,
and returns best parameters.
Should be invoked <strong>prior</strong> to running <code>CausalInferencemodel.fit</code>.
If <code>scoring</code> is None, then 'roc_auc' is used for classification and 'negative_mean_squared_error'
is used for regresssion.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.predict" class="doc_header"><code>CausalInferenceModel.predict</code><a href="__main__.py#L186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.predict</code>(<strong><code>df</code></strong>, <strong><code>p</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Estimates the treatment effect for each observation in <code>df</code>.
The DataFrame represented by <code>df</code> should be the same format
as the one supplied to <a href="/causalnlp/causalinference.html#CausalInferenceModel.__init__"><code>CausalInferenceModel.__init__</code></a>.
For X-Learner and R-Learner, propensity scores will be computed
using default propensity model unless <code>p</code> is not None.
Parameter <code>p</code> is not used for other methods.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.get_required_columns" class="doc_header"><code>CausalInferenceModel.get_required_columns</code><a href="__main__.py#L352" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.get_required_columns</code>()</p>
</blockquote>
<p>Returns required columns that must exist in any DataFrame supplied to <a href="/causalnlp/causalinference.html#CausalInferenceModel.predict"><code>CausalInferenceModel.predict</code></a>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.estimate_ate" class="doc_header"><code>CausalInferenceModel.estimate_ate</code><a href="__main__.py#L209" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.estimate_ate</code>(<strong><code>bool_mask</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Estimates the treatment effect for each observation in
<code>self.df</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>bool_mask</code> parameter can be used to estimate the conditional average treatment estimate (CATE).
For instance, to estimate the average treatment effect for only those individuals over 18 years of age:</p>
<div class="highlight"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">18</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.evaluate_robustness" class="doc_header"><code>CausalInferenceModel.evaluate_robustness</code><a href="__main__.py#L418" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.evaluate_robustness</code>(<strong><code>sample_size</code></strong>=<em><code>0.8</code></em>)</p>
</blockquote>
<p>Evaluates robustness on four sensitivity measures (see CausalML package for details on these methods):</p>
<ul>
<li><strong>Placebo Treatment</strong>: ATE should become zero.</li>
<li><strong>Random Cause</strong>: ATE should not change.</li>
<li><strong>Random Replacement</strong>: ATE should not change.</li>
<li><strong>Subset Data</strong>: ATE should not change.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.interpret" class="doc_header"><code>CausalInferenceModel.interpret</code><a href="__main__.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.interpret</code>(<strong><code>plot</code></strong>=<em><code>False</code></em>, <strong><code>method</code></strong>=<em><code>'feature_importance'</code></em>)</p>
</blockquote>
<p>Returns feature importances of treatment effect model.
The method parameter must be one of {'feature_importance', 'shap_values'}</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalInferenceModel.explain" class="doc_header"><code>CausalInferenceModel.explain</code><a href="__main__.py#L311" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalInferenceModel.explain</code>(<strong><code>df</code></strong>, <strong><code>row_index</code></strong>=<em><code>None</code></em>, <strong><code>row_num</code></strong>=<em><code>0</code></em>, <strong><code>background_size</code></strong>=<em><code>50</code></em>, <strong><code>nsamples</code></strong>=<em><code>500</code></em>)</p>
</blockquote>
<p>Explain the treatment effect estimate of a single observation using SHAP.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>df</strong> (pd.DataFrame): a pd.DataFrame of test data is same format as original training data DataFrame</li>
<li><strong>row_num</strong> (int): raw row number in DataFrame to explain (default:0, the first row)</li>
<li><strong>background_size</strong> (int): size of background data (SHAP parameter)</li>
<li><strong>nsamples</strong> (int): number of samples (SHAP parameter)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Usage-Example:-Do-social-media-posts-by-women-get-shared-more-often-than-those-by-men?">Usage Example: Do social media posts by women get shared more often than those by men?<a class="anchor-link" href="#Usage-Example:-Do-social-media-posts-by-women-get-shared-more-often-than-those-by-men?"> </a></h2><p>Let's create a simulated dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">192</span><span class="p">]))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">,</span> <span class="s1">&#39;Post_Text&#39;</span><span class="p">,</span> <span class="s1">&#39;Post_Shared?&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
<span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;I really love my job!&#39;</span><span class="p">,</span> <span class="s1">&#39;My boss is pretty terrible.&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">original_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">original_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Is_Male?</th>
      <th>Post_Text</th>
      <th>Post_Shared?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At first glance, it seems like posts by women get shared more often.  More specifically, it appears that being male <strong>reduces</strong> your the chance your post is shared by 4.5 percentage points:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">male_probability</span> <span class="o">=</span> <span class="n">original_df</span><span class="p">[(</span><span class="n">original_df</span><span class="p">[</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">male_probability</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.78</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">female_probability</span> <span class="o">=</span> <span class="n">original_df</span><span class="p">[(</span><span class="n">original_df</span><span class="p">[</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">female_probability</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.8257142857142857</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">male_probability</span><span class="o">-</span><span class="n">female_probability</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.04571428571428571</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, this is inaccurate. In fact, this is an example of <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson's Paradox</a>, and the true causal effect of being male in this simulated datsaet is roughly <strong>0.05</strong> (as opposed to <strong>-0.045</strong>) with men's posts being more likely to be shared. The reason is that women in this simulation tend to make more positive posts which tend to be shared more often here. Post sentiment, then, is a <a href="https://en.wikipedia.org/wiki/Mediation_(statistics">mediator</a>, which is statistically statistically similar to a <a href="https://en.wikipedia.org/wiki/Confounding">confounder</a>.</p>
<p>When controlling for the sentiment of the post (the mediator variable in this dataset), it is revealed that men's posts are, in fact, shared more often (for both negative posts and positive posts). This can be quickly and easily estimated in <strong>CausalNLP</strong>.</p>
<h3 id="Causal-Inference-from-Text-with-Autocoders">Causal Inference from Text with Autocoders<a class="anchor-link" href="#Causal-Inference-from-Text-with-Autocoders"> </a></h3><p>Let's first use the <a href="/causalnlp/autocoder.html#Autocoder"><code>Autocoder</code></a> to transform the raw text into sentiment.  We can then control for sentiment when estimating the causal effect.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">causalnlp.autocoder</span> <span class="kn">import</span> <span class="n">Autocoder</span>
<span class="n">ac</span> <span class="o">=</span> <span class="n">Autocoder</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">code_sentiment</span><span class="p">(</span><span class="n">original_df</span><span class="p">[</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">original_df</span><span class="p">,</span> <span class="n">binarize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Is_Male?</th>
      <th>Post_Text</th>
      <th>Post_Shared?</th>
      <th>negative</th>
      <th>positive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0.019191</td>
      <td>0.980809</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0.019191</td>
      <td>0.980809</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0.019191</td>
      <td>0.980809</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0.019191</td>
      <td>0.980809</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0.019191</td>
      <td>0.980809</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When autocoding the raw text for sentiment, we have chosen to use the raw "probabilities" with <code>binarize=False</code>.  A binary variable can also be used with <code>binarize=True</code>.</p>
<p>Next, let's estimate the treatment effects. We will ignore the <code>positive</code> and <code>Post_Shared?</code> columns, as their information is captured by the <code>negative</code> column in this example. We will use the T-Learner. See <a href="https://arxiv.org/abs/1706.03461">this paper</a> for more information on metalearner types.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">causalnlp.causalinference</span> <span class="kn">import</span> <span class="n">CausalInferenceModel</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">CausalInferenceModel</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;t-learner&#39;</span><span class="p">,</span>
                          <span class="n">treatment_col</span><span class="o">=</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">,</span>
                          <span class="n">include_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">])</span>
<span class="n">cm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>outcome column (categorical): Post_Shared?
treatment column: Is_Male?
numerical/categorical covariates: [&#39;negative&#39;]
preprocess time:  0.012983322143554688  sec
start fitting causal inference model
time to fit causal inference model:  0.9569253921508789  sec
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;causalnlp.causalinference.CausalInferenceModel at 0x7efd400dbd30&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Upon controlling for sentiment, we see that the overall average treatment is correctly estimated as 0.05.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ate</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">()</span>
<span class="n">ate</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.05366850622769351}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since this is a small, simulated, toy problem, we can manually calculate the adjusted treatment effect by controlling for the single counfounder (i.e., post negativity):</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="k">def</span> <span class="nf">ATE_adjusted</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">C0_ATE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">C1_ATE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">C0_ATE</span><span class="p">,</span> <span class="n">C1_ATE</span><span class="p">])</span>
<span class="n">ATE_adjusted</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0534529194528211</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see that this value is close to our estimate.</p>
<p><strong>CausalNLP</strong> allows you to easily compute conditional or individualized treatment effects.
For instance, for negative posts, being male increases the chance of your post being shared by about 4 percentage points:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.042535751074149745}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For positive posts, being male increases the chance of your post being shared by about 6 percentage points:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.06436468274776497}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">ate</span><span class="p">[</span><span class="s1">&#39;ate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span>
<span class="k">assert</span> <span class="n">ate</span><span class="p">[</span><span class="s1">&#39;ate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.055</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predictions can be made for new observations.    We just have to make sure it contains the relevant columns included in the DataFrame supplied to <a href="/causalnlp/causalinference.html#CausalInferenceModel.fit"><code>CausalInferenceModel.fit</code></a>. In this case, it must include <code>Is_Male?</code> and <code>negative</code>. This can be verified with the <a href="/causalnlp/causalinference.html#CausalInferenceModel.get_required_columns"><code>CausalInferenceModel.get_required_columns</code></a> method:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">get_required_columns</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Is_Male?&#39;, &#39;negative&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
     <span class="s1">&#39;text&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;I love my life.&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Is_Male?&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;negative&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="p">})</span>
<span class="n">effect</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">effect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.065</span>
<span class="k">assert</span> <span class="n">effect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.064</span>
<span class="nb">print</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0.06436468]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Causal-Inference-Using-Raw-Text-as-a-Confounder/Mediator">Causal Inference Using Raw Text as a Confounder/Mediator<a class="anchor-link" href="#Causal-Inference-Using-Raw-Text-as-a-Confounder/Mediator"> </a></h3><p>In the example above, we approached the problem under the assumption that a specific lingustic property (sentiment) was an important mediator or confounder for which to control. In some cases, there may also be other unknown lingustic properties that are potential confounders/mediators (e.g., topic, politeness, toxic language, readability).</p>
<p>In <strong>CausalNLP</strong>, we can also use the <strong>raw text</strong> as the potential confounder/mediator.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">CausalInferenceModel</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;t-learner&#39;</span><span class="p">,</span>
                          <span class="n">treatment_col</span><span class="o">=</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">,</span> <span class="n">text_col</span><span class="o">=</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">,</span>
                         <span class="n">ignore_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="s1">&#39;positive&#39;</span><span class="p">])</span>
<span class="n">cm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>outcome column (categorical): Post_Shared?
treatment column: Is_Male?
numerical/categorical covariates: []
text covariate: Post_Text
preprocess time:  0.01604151725769043  sec
start fitting causal inference model
time to fit causal inference model:  0.08830595016479492  sec
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;causalnlp.causalinference.CausalInferenceModel at 0x7efd400ea358&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Although we have excluded the <strong>negative</strong> and <strong>positive</strong> columns as extra covariates, you can use traditional categorical/numerical covariates in combination with a text field covariate (if they exist as extra columns in the dataframe).</p>
<p>Here, we see that the same causal estimates are returned, as the text is easy to infer as positive or negative based on their correlations with the outcomes in this problem.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ate</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">()</span>
<span class="n">ate</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.05366850622769351}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;My boss is pretty terrible.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.042535751074149745}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;I really love my job!&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.06436468274776497}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">ate</span><span class="p">[</span><span class="s1">&#39;ate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span>
<span class="k">assert</span> <span class="n">ate</span><span class="p">[</span><span class="s1">&#39;ate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.055</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>Make predictions on new data.  Again, make sure the DataFrame contains the relevant columns included in the original DataFrame supplied to [`CausalInferenceModel.fit`](/causalnlp/causalinference.html#CausalInferenceModel.fit):</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">get_required_columns</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Is_Male?&#39;, &#39;Post_Text&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
     <span class="s1">&#39;Post_Text&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;I love my life.&#39;</span><span class="p">],</span>
    <span class="s1">&#39;New Column&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;Is_Male?&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;negative&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="p">})</span>
<span class="n">effect</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">effect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.065</span>
<span class="k">assert</span> <span class="n">effect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.064</span>
<span class="nb">print</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0.06436468]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;feature_importance&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{1: v_boss        1.0
 v_terrible    0.0
 v_pretty      0.0
 dtype: float64}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;feature_importance&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;shap_values&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Causal-Inference-With-Text-as-a-Treatment">Causal Inference With Text as a Treatment<a class="anchor-link" href="#Causal-Inference-With-Text-as-a-Treatment"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we were interested in estimating the causal impact of <strong>sentiment</strong> on the outcome.  That is, <strong>sentiment</strong> of text is the treatment, and the <strong>gender</strong> is a potential confounder. As we did above, we can use the <a href="/causalnlp/autocoder.html#Autocoder"><code>Autocoder</code></a> to create the treatment variable.  The only difference is that we would supply the <code>binarize=True</code> as an argument.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">code_sentiment</span><span class="p">(</span><span class="n">original_df</span><span class="p">[</span><span class="s1">&#39;Post_Text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">original_df</span><span class="p">,</span> <span class="n">binarize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Is_Male?</th>
      <th>Post_Text</th>
      <th>Post_Shared?</th>
      <th>negative</th>
      <th>positive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>I really love my job!</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">CausalInferenceModel</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;t-learner&#39;</span><span class="p">,</span>
                          <span class="n">treatment_col</span><span class="o">=</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;Post_Shared?&#39;</span><span class="p">,</span>
                          <span class="n">include_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Is_Male?&#39;</span><span class="p">])</span>
<span class="n">cm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>outcome column (categorical): Post_Shared?
treatment column: positive
numerical/categorical covariates: [&#39;Is_Male?&#39;]
preprocess time:  0.009029388427734375  sec
start fitting causal inference model
time to fit causal inference model:  0.6834802627563477  sec
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;causalnlp.causalinference.CausalInferenceModel at 0x7efd2cd955f8&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ate</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">estimate_ate</span><span class="p">()</span>
<span class="n">ate</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ate&#39;: 0.19008080596986368}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">ate</span><span class="p">[</span><span class="s1">&#39;ate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.18</span>
<span class="k">assert</span> <span class="n">ate</span><span class="p">[</span><span class="s1">&#39;ate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span><span class="o">.</span><span class="n">get_required_columns</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;positive&#39;, &#39;Is_Male?&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Is_Male?&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;positive&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">})</span>
<span class="n">effect</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0.20099539]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="platt_scale" class="doc_header"><code>platt_scale</code><a href="https://github.com/amaiya/causalnlp/tree/main/causalnlp/causalinference.py#L490" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>platt_scale</code>(<strong><code>outcome</code></strong>, <strong><code>probs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gelu" class="doc_header"><code>gelu</code><a href="https://github.com/amaiya/causalnlp/tree/main/causalnlp/causalinference.py#L498" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gelu</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_bow_vector" class="doc_header"><code>make_bow_vector</code><a href="https://github.com/amaiya/causalnlp/tree/main/causalnlp/causalinference.py#L502" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_bow_vector</code>(<strong><code>ids</code></strong>, <strong><code>vocab_size</code></strong>, <strong><code>use_counts</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Make a sparse BOW vector from a tensor of dense ids.
Args:
    ids: torch.LongTensor [batch, features]. Dense tensor of ids.
    vocab_size: vocab size for this tensor.
    use_counts: if true, the outgoing BOW vector will contain
        feature counts. If false, will contain binary indicators.
Returns:
    The sparse bag-of-words representation of ids.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CausalBert" class="doc_header"><code>class</code> <code>CausalBert</code><a href="https://github.com/amaiya/causalnlp/tree/main/causalnlp/causalinference.py#L527" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CausalBert</code>(<strong><code>config</code></strong>) :: <code>DistilBertPreTrainedModel</code></p>
</blockquote>
<p>CausalBert is essentially an S-Learner that uses a DistilBert sequence classification model as the base learner.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CausalBertModel" class="doc_header"><code>class</code> <code>CausalBertModel</code><a href="https://github.com/amaiya/causalnlp/tree/main/causalnlp/causalinference.py#L625" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CausalBertModel</code>(<strong><code>g_weight</code></strong>=<em><code>0.0</code></em>, <strong><code>Q_weight</code></strong>=<em><code>0.1</code></em>, <strong><code>mlm_weight</code></strong>=<em><code>1.0</code></em>, <strong><code>batch_size</code></strong>=<em><code>32</code></em>, <strong><code>max_length</code></strong>=<em><code>128</code></em>)</p>
</blockquote>
<p>CausalBertModel is a wrapper for CausalBert</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalBertModel.train" class="doc_header"><code>CausalBertModel.train</code><a href="__main__.py#L200" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalBertModel.train</code>(<strong><code>texts</code></strong>, <strong><code>confounds</code></strong>, <strong><code>treatments</code></strong>, <strong><code>outcomes</code></strong>, <strong><code>learning_rate</code></strong>=<em><code>2e-05</code></em>, <strong><code>epochs</code></strong>=<em><code>3</code></em>)</p>
</blockquote>
<p>Trains a CausalBert model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalBertModel.estimate_ate" class="doc_header"><code>CausalBertModel.estimate_ate</code><a href="__main__.py#L261" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalBertModel.estimate_ate</code>(<strong><code>C</code></strong>, <strong><code>W</code></strong>, <strong><code>Y</code></strong>=<em><code>None</code></em>, <strong><code>platt_scaling</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Computes average treatment effect using the trained estimator</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CausalBertModel.inference" class="doc_header"><code>CausalBertModel.inference</code><a href="__main__.py#L237" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CausalBertModel.inference</code>(<strong><code>texts</code></strong>, <strong><code>confounds</code></strong>, <strong><code>outcome</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Perform inference using the trained model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

