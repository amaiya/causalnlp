<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Causal Inference API">

<title>causalnlp - Causal Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="causalnlp - Causal Inference">
<meta property="og:description" content="Causal Inference API">
<meta property="og:site_name" content="causalnlp">
<meta name="twitter:title" content="causalnlp - Causal Inference">
<meta name="twitter:description" content="Causal Inference API">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">causalnlp</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./core.causalinference.html">Causal Inference</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to CausalNLP</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.causalinference.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Causal Inference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.causalbert.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CausalBert</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./autocoder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Auto Coder</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyzers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./key_driver_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key Driver Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base Metalearner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.tlearner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T-Learner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.slearner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">S-Learner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.xlearner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">X-Learner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.rlearner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R-Learner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metalearner Utils</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.explainer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metalearner Explainer</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.propensity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metalearner Propensity</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.sensitivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metalearner Sensitivity</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#causalinferencemodel" id="toc-causalinferencemodel" class="nav-link active" data-scroll-target="#causalinferencemodel">CausalInferenceModel</a></li>
  <li><a href="#causalinferencemodel.fit" id="toc-causalinferencemodel.fit" class="nav-link" data-scroll-target="#causalinferencemodel.fit">CausalInferenceModel.fit</a></li>
  <li><a href="#causalinferencemodel.tune_and_use_default_learner" id="toc-causalinferencemodel.tune_and_use_default_learner" class="nav-link" data-scroll-target="#causalinferencemodel.tune_and_use_default_learner">CausalInferenceModel.tune_and_use_default_learner</a></li>
  <li><a href="#causalinferencemodel.predict" id="toc-causalinferencemodel.predict" class="nav-link" data-scroll-target="#causalinferencemodel.predict">CausalInferenceModel.predict</a></li>
  <li><a href="#causalinferencemodel.get_required_columns" id="toc-causalinferencemodel.get_required_columns" class="nav-link" data-scroll-target="#causalinferencemodel.get_required_columns">CausalInferenceModel.get_required_columns</a></li>
  <li><a href="#causalinferencemodel.estimate_ate" id="toc-causalinferencemodel.estimate_ate" class="nav-link" data-scroll-target="#causalinferencemodel.estimate_ate">CausalInferenceModel.estimate_ate</a></li>
  <li><a href="#causalinferencemodel.evaluate_robustness" id="toc-causalinferencemodel.evaluate_robustness" class="nav-link" data-scroll-target="#causalinferencemodel.evaluate_robustness">CausalInferenceModel.evaluate_robustness</a></li>
  <li><a href="#causalinferencemodel.interpret" id="toc-causalinferencemodel.interpret" class="nav-link" data-scroll-target="#causalinferencemodel.interpret">CausalInferenceModel.interpret</a></li>
  <li><a href="#causalinferencemodel.explain" id="toc-causalinferencemodel.explain" class="nav-link" data-scroll-target="#causalinferencemodel.explain">CausalInferenceModel.explain</a></li>
  <li><a href="#usage-example-do-social-media-posts-by-women-get-shared-more-often-than-those-by-men" id="toc-usage-example-do-social-media-posts-by-women-get-shared-more-often-than-those-by-men" class="nav-link" data-scroll-target="#usage-example-do-social-media-posts-by-women-get-shared-more-often-than-those-by-men">Usage Example: Do social media posts by women get shared more often than those by men?</a>
  <ul class="collapse">
  <li><a href="#causal-inference-from-text-with-autocoders" id="toc-causal-inference-from-text-with-autocoders" class="nav-link" data-scroll-target="#causal-inference-from-text-with-autocoders">Causal Inference from Text with Autocoders</a></li>
  <li><a href="#causal-inference-using-raw-text-as-a-confoundermediator" id="toc-causal-inference-using-raw-text-as-a-confoundermediator" class="nav-link" data-scroll-target="#causal-inference-using-raw-text-as-a-confoundermediator">Causal Inference Using Raw Text as a Confounder/Mediator</a></li>
  <li><a href="#causal-inference-with-text-as-a-treatment" id="toc-causal-inference-with-text-as-a-treatment" class="nav-link" data-scroll-target="#causal-inference-with-text-as-a-treatment">Causal Inference With Text as a Treatment</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/amaiya/causalnlp/tree/main/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Causal Inference</h1>
</div>

<div>
  <div class="description">
    Causal Inference API
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L37" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="causalinferencemodel" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel">CausalInferenceModel</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel (df, method='t-learner', metalearner_type=None,
                       treatment_col='treatment', outcome_col='outcome',
                       text_col=None, ignore_cols=[], include_cols=[],
                       treatment_effect_col='treatment_effect',
                       learner=None, effect_learner=None, min_df=0.05,
                       max_df=0.5, ngram_range=(1, 1),
                       stop_words='english', verbose=1)</code></pre>
</blockquote>
<p>*Infers causality from the data contained in <code>df</code> using a metalearner.</p>
<p>Usage:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cm <span class="op">=</span> CausalInferenceModel(df, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                              treatment_col<span class="op">=</span><span class="st">'Is_Male?'</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                              outcome_col<span class="op">=</span><span class="st">'Post_Shared?'</span>, text_col<span class="op">=</span><span class="st">'Post_Text'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                              ignore_cols<span class="op">=</span>[<span class="st">'id'</span>, <span class="st">'email'</span>])</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    cm.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>df</strong> : pandas.DataFrame containing dataset</li>
<li><strong>method</strong> : metalearner model to use. One of {‘t-learner’, ‘s-learner’, ‘x-learner’, ‘r-learner’} (Default: ‘t-learner’)</li>
<li><strong>metalearner_type</strong> : Alias of <code>method</code> for backwards compatibility. Overrides <code>method</code> if not None.</li>
<li><strong>treatment_col</strong> : treatment variable; column should contain binary values: 1 for treated, 0 for untreated.</li>
<li><strong>outcome_col</strong> : outcome variable; column should contain the categorical or numeric outcome values</li>
<li><strong>text_col</strong> : (optional) text column containing the strings (e.g., articles, reviews, emails).</li>
<li><strong>ignore_cols</strong> : columns to ignore in the analysis</li>
<li><strong>include_cols</strong> : columns to include as covariates (e.g., possible confounders)</li>
<li><strong>treatment_effect_col</strong> : name of column to hold causal effect estimations. Does not need to exist. Created by CausalNLP.</li>
<li><strong>learner</strong> : an instance of a custom learner. If None, Log/Lin Regression is used for S-Learner and a default LightGBM model will be used for all other metalearner types. # Example learner = LGBMClassifier(num_leaves=1000)</li>
<li><strong>effect_learner</strong>: used for x-learner/r-learner and must be regression model</li>
<li><strong>min_df</strong> : min_df parameter used for text processing using sklearn</li>
<li><strong>max_df</strong> : max_df parameter used for text procesing using sklearn</li>
<li><strong>ngram_range</strong>: ngrams used for text vectorization. default: (1,1)</li>
<li><strong>stop_words</strong> : stop words used for text processing (from sklearn)</li>
<li><strong>verbose</strong> : If 1, print informational messages. If 0, suppress.*</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>method</td>
<td>str</td>
<td>t-learner</td>
<td></td>
</tr>
<tr class="odd">
<td>metalearner_type</td>
<td>NoneType</td>
<td>None</td>
<td>alias for method</td>
</tr>
<tr class="even">
<td>treatment_col</td>
<td>str</td>
<td>treatment</td>
<td></td>
</tr>
<tr class="odd">
<td>outcome_col</td>
<td>str</td>
<td>outcome</td>
<td></td>
</tr>
<tr class="even">
<td>text_col</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>ignore_cols</td>
<td>list</td>
<td>[]</td>
<td></td>
</tr>
<tr class="even">
<td>include_cols</td>
<td>list</td>
<td>[]</td>
<td></td>
</tr>
<tr class="odd">
<td>treatment_effect_col</td>
<td>str</td>
<td>treatment_effect</td>
<td></td>
</tr>
<tr class="even">
<td>learner</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>effect_learner</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>min_df</td>
<td>float</td>
<td>0.05</td>
<td></td>
</tr>
<tr class="odd">
<td>max_df</td>
<td>float</td>
<td>0.5</td>
<td></td>
</tr>
<tr class="even">
<td>ngram_range</td>
<td>tuple</td>
<td>(1, 1)</td>
<td></td>
</tr>
<tr class="odd">
<td>stop_words</td>
<td>str</td>
<td>english</td>
<td></td>
</tr>
<tr class="even">
<td>verbose</td>
<td>int</td>
<td>1</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L172" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.fit" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.fit">CausalInferenceModel.fit</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.fit (p=None)</code></pre>
</blockquote>
<p><em>Fits a causal inference model and estimates outcome with and without treatment for each observation. For X-Learner and R-Learner, propensity scores will be computed using default propensity model unless <code>p</code> is not None. Parameter <code>p</code> is not used for other methods.</em></p>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L365" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.tune_and_use_default_learner" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.tune_and_use_default_learner">CausalInferenceModel.tune_and_use_default_learner</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.tune_and_use_default_learner (split_pct=0.2,
                                                    random_state=314,
                                                    scoring=None)</code></pre>
</blockquote>
<p><em>Tunes the hyperparameters of a default LightGBM model, replaces <code>CausalInferenceModel.learner</code>, and returns best parameters. Should be invoked <strong>prior</strong> to running <code>CausalInferencemodel.fit</code>. If <code>scoring</code> is None, then ‘roc_auc’ is used for classification and ‘negative_mean_squared_error’ is used for regresssion.</em></p>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L188" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.predict" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.predict">CausalInferenceModel.predict</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.predict (df, p=None)</code></pre>
</blockquote>
<p><em>Estimates the treatment effect for each observation in <code>df</code>. The DataFrame represented by <code>df</code> should be the same format as the one supplied to <a href="https://amaiya.github.io/causalnlp/core.causalinference.html#causalinferencemodel.__init__"><code>CausalInferenceModel.__init__</code></a>. For X-Learner and R-Learner, propensity scores will be computed using default propensity model unless <code>p</code> is not None. Parameter <code>p</code> is not used for other methods.</em></p>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L354" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.get_required_columns" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.get_required_columns">CausalInferenceModel.get_required_columns</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.get_required_columns ()</code></pre>
</blockquote>
<p><em>Returns required columns that must exist in any DataFrame supplied to <a href="https://amaiya.github.io/causalnlp/core.causalinference.html#causalinferencemodel.predict"><code>CausalInferenceModel.predict</code></a>.</em></p>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L211" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.estimate_ate" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.estimate_ate">CausalInferenceModel.estimate_ate</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.estimate_ate (bool_mask=None)</code></pre>
</blockquote>
<p><em>Estimates the treatment effect for each observation in <code>self.df</code>.</em></p>
<p>The <code>bool_mask</code> parameter can be used to estimate the conditional average treatment estimate (CATE). For instance, to estimate the average treatment effect for only those individuals over 18 years of age:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cm.estimate_ate(cm.df[<span class="st">'age'</span>]<span class="op">&gt;</span><span class="dv">18</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L420" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.evaluate_robustness" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.evaluate_robustness">CausalInferenceModel.evaluate_robustness</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.evaluate_robustness (sample_size=0.8)</code></pre>
</blockquote>
<p><em>Evaluates robustness on four sensitivity measures (see CausalML package for details on these methods): - <strong>Placebo Treatment</strong>: ATE should become zero. - <strong>Random Cause</strong>: ATE should not change. - <strong>Random Replacement</strong>: ATE should not change. - <strong>Subset Data</strong>: ATE should not change.</em></p>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L222" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.interpret" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.interpret">CausalInferenceModel.interpret</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.interpret (plot=False, method='feature_importance')</code></pre>
</blockquote>
<p><em>Returns feature importances of treatment effect model. The method parameter must be one of {‘feature_importance’, ‘shap_values’}</em></p>
<hr>
<p><a href="https://github.com/amaiya/causalnlp/tree/main/blob/main/causalnlp/core/causalinference.py#L313" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="causalinferencemodel.explain" class="level3">
<h3 class="anchored" data-anchor-id="causalinferencemodel.explain">CausalInferenceModel.explain</h3>
<blockquote class="blockquote">
<pre><code> CausalInferenceModel.explain (df, row_index=None, row_num=0,
                               background_size=50, nsamples=500)</code></pre>
</blockquote>
<p>*Explain the treatment effect estimate of a single observation using SHAP.</p>
<p><strong>Parameters:</strong> - <strong>df</strong> (pd.DataFrame): a pd.DataFrame of test data is same format as original training data DataFrame - <strong>row_num</strong> (int): raw row number in DataFrame to explain (default:0, the first row) - <strong>background_size</strong> (int): size of background data (SHAP parameter) - <strong>nsamples</strong> (int): number of samples (SHAP parameter)*</p>
</section>
<section id="usage-example-do-social-media-posts-by-women-get-shared-more-often-than-those-by-men" class="level2">
<h2 class="anchored" data-anchor-id="usage-example-do-social-media-posts-by-women-get-shared-more-often-than-those-by-men">Usage Example: Do social media posts by women get shared more often than those by men?</h2>
<p>Let’s create a simulated dataset.</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> ((<span class="op">*</span>a, b) <span class="cf">for</span> (a, b) <span class="kw">in</span> <span class="bu">zip</span>(itertools.product([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>]), [<span class="dv">36</span>, <span class="dv">234</span>, <span class="dv">25</span>, <span class="dv">55</span>, <span class="dv">6</span>, <span class="dv">81</span>, <span class="dv">71</span>, <span class="dv">192</span>]))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'Is_Male?'</span>, <span class="st">'Post_Text'</span>, <span class="st">'Post_Shared?'</span>, <span class="st">'N'</span>])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[df.index.repeat(df[<span class="st">'N'</span>])].reset_index(drop<span class="op">=</span><span class="va">True</span>).drop(columns<span class="op">=</span>[<span class="st">'N'</span>])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'Post_Text'</span>].unique())</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Post_Text'</span>].replace(values, [<span class="st">'I really love my job!'</span>, <span class="st">'My boss is pretty terrible.'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>original_df <span class="op">=</span> df.copy()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>original_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Is_Male?</th>
<th data-quarto-table-cell-role="th">Post_Text</th>
<th data-quarto-table-cell-role="th">Post_Shared?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>At first glance, it seems like posts by women get shared more often. More specifically, it appears that being male <strong>reduces</strong> your the chance your post is shared by 4.5 percentage points:</p>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>male_probability <span class="op">=</span> original_df[(original_df[<span class="st">'Is_Male?'</span>]<span class="op">==</span><span class="dv">1</span>)][<span class="st">'Post_Shared?'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)[<span class="dv">1</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>male_probability</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.78</code></pre>
</div>
</div>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>female_probability <span class="op">=</span> original_df[(original_df[<span class="st">'Is_Male?'</span>]<span class="op">==</span><span class="dv">0</span>)][<span class="st">'Post_Shared?'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)[<span class="dv">1</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>female_probability</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.8257142857142857</code></pre>
</div>
</div>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>male_probability<span class="op">-</span>female_probability</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>-0.04571428571428571</code></pre>
</div>
</div>
<p>However, this is inaccurate. In fact, this is an example of <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s Paradox</a>, and the true causal effect of being male in this simulated datsaet is roughly <strong>0.05</strong> (as opposed to <strong>-0.045</strong>) with men’s posts being more likely to be shared. The reason is that women in this simulation tend to make more positive posts which tend to be shared more often here. Post sentiment, then, is a [mediator](https://en.wikipedia.org/wiki/Mediation_(statistics), which is statistically statistically similar to a <a href="https://en.wikipedia.org/wiki/Confounding">confounder</a>.</p>
<p>When controlling for the sentiment of the post (the mediator variable in this dataset), it is revealed that men’s posts are, in fact, shared more often (for both negative posts and positive posts). This can be quickly and easily estimated in <strong>CausalNLP</strong>.</p>
<section id="causal-inference-from-text-with-autocoders" class="level3">
<h3 class="anchored" data-anchor-id="causal-inference-from-text-with-autocoders">Causal Inference from Text with Autocoders</h3>
<p>Let’s first use the <a href="https://amaiya.github.io/causalnlp/autocoder.html#autocoder"><code>Autocoder</code></a> to transform the raw text into sentiment. We can then control for sentiment when estimating the causal effect.</p>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> causalnlp.autocoder <span class="im">import</span> Autocoder</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ac <span class="op">=</span> Autocoder()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f85a51703c48484d846afecfaa37068e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> ac.code_sentiment(original_df[<span class="st">'Post_Text'</span>].values, original_df, binarize<span class="op">=</span><span class="va">False</span>, batch_size<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Is_Male?</th>
<th data-quarto-table-cell-role="th">Post_Text</th>
<th data-quarto-table-cell-role="th">Post_Shared?</th>
<th data-quarto-table-cell-role="th">negative</th>
<th data-quarto-table-cell-role="th">positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0.019191</td>
<td>0.980809</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0.019191</td>
<td>0.980809</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0.019191</td>
<td>0.980809</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0.019191</td>
<td>0.980809</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0.019191</td>
<td>0.980809</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>When autocoding the raw text for sentiment, we have chosen to use the raw “probabilities” with <code>binarize=False</code>. A binary variable can also be used with <code>binarize=True</code>.</p>
<p>Next, let’s estimate the treatment effects. We will ignore the <code>positive</code> and <code>Post_Shared?</code> columns, as their information is captured by the <code>negative</code> column in this example. We will use the T-Learner. See <a href="https://arxiv.org/abs/1706.03461">this paper</a> for more information on metalearner types.</p>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> causalnlp <span class="im">import</span> CausalInferenceModel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> CausalInferenceModel(df, method<span class="op">=</span><span class="st">'t-learner'</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                          treatment_col<span class="op">=</span><span class="st">'Is_Male?'</span>, outcome_col<span class="op">=</span><span class="st">'Post_Shared?'</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                          include_cols<span class="op">=</span>[<span class="st">'negative'</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>cm.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>outcome column (categorical): Post_Shared?
treatment column: Is_Male?
numerical/categorical covariates: ['negative']
preprocess time:  0.013550996780395508  sec
start fitting causal inference model
time to fit causal inference model:  0.8901166915893555  sec</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;causalnlp.core.causalinference.CausalInferenceModel&gt;</code></pre>
</div>
</div>
<p>Upon controlling for sentiment, we see that the overall average treatment is correctly estimated as 0.05.</p>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ate <span class="op">=</span> cm.estimate_ate()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.05366850622769351}</code></pre>
</div>
</div>
<p>Since this is a small, simulated, toy problem, we can manually calculate the adjusted treatment effect by controlling for the single counfounder (i.e., post negativity):</p>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ATE_adjusted(C, T, Y):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c, t, y <span class="kw">in</span> <span class="bu">zip</span>(C, T, Y):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        x[c, t].append(y)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    C0_ATE <span class="op">=</span> np.mean(x[<span class="dv">0</span>,<span class="dv">1</span>]) <span class="op">-</span> np.mean(x[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    C1_ATE <span class="op">=</span> np.mean(x[<span class="dv">1</span>,<span class="dv">1</span>]) <span class="op">-</span> np.mean(x[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean([C0_ATE, C1_ATE])</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>ATE_adjusted((df[<span class="st">'negative'</span>]<span class="op">&gt;</span><span class="fl">0.5</span>).astype(<span class="st">'int'</span>), df[<span class="st">'Is_Male?'</span>].values, df[<span class="st">'Post_Shared?'</span>].values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.0534529194528211</code></pre>
</div>
</div>
<p>We see that this value is close to our estimate.</p>
<p><strong>CausalNLP</strong> allows you to easily compute conditional or individualized treatment effects. For instance, for negative posts, being male increases the chance of your post being shared by about 4 percentage points:</p>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>cm.estimate_ate(cm.df[<span class="st">'negative'</span>]<span class="op">&gt;</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.042535751074149745}</code></pre>
</div>
</div>
<p>For positive posts, being male increases the chance of your post being shared by about 6 percentage points:</p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>cm.estimate_ate(cm.df[<span class="st">'negative'</span>]<span class="op">&lt;</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.06436468274776497}</code></pre>
</div>
</div>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ate[<span class="st">'ate'</span>] <span class="op">&gt;</span> <span class="fl">0.05</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ate[<span class="st">'ate'</span>] <span class="op">&lt;</span> <span class="fl">0.055</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Predictions can be made for new observations. We just have to make sure it contains the relevant columns included in the DataFrame supplied to <a href="https://amaiya.github.io/causalnlp/core.causalinference.html#causalinferencemodel.fit"><code>CausalInferenceModel.fit</code></a>. In this case, it must include <code>Is_Male?</code> and <code>negative</code>. This can be verified with the <a href="https://amaiya.github.io/causalnlp/core.causalinference.html#causalinferencemodel.get_required_columns"><code>CausalInferenceModel.get_required_columns</code></a> method:</p>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cm.get_required_columns()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Is_Male?', 'negative']</code></pre>
</div>
</div>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>     <span class="st">'text'</span> : [<span class="st">'I love my life.'</span>],</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Is_Male?'</span> : [<span class="dv">0</span>],</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'negative'</span> : [<span class="dv">0</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>effect <span class="op">=</span> cm.predict(test_df)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> effect[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">&lt;</span> <span class="fl">0.065</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> effect[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">&gt;</span> <span class="fl">0.064</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.06436468]]</code></pre>
</div>
</div>
</section>
<section id="causal-inference-using-raw-text-as-a-confoundermediator" class="level3">
<h3 class="anchored" data-anchor-id="causal-inference-using-raw-text-as-a-confoundermediator">Causal Inference Using Raw Text as a Confounder/Mediator</h3>
<p>In the example above, we approached the problem under the assumption that a specific lingustic property (sentiment) was an important mediator or confounder for which to control. In some cases, there may also be other unknown lingustic properties that are potential confounders/mediators (e.g., topic, politeness, toxic language, readability).</p>
<p>In <strong>CausalNLP</strong>, we can also use the <strong>raw text</strong> as the potential confounder/mediator.</p>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> CausalInferenceModel(df, method<span class="op">=</span><span class="st">'t-learner'</span>,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                          treatment_col<span class="op">=</span><span class="st">'Is_Male?'</span>, outcome_col<span class="op">=</span><span class="st">'Post_Shared?'</span>, text_col<span class="op">=</span><span class="st">'Post_Text'</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                         ignore_cols<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'positive'</span>])</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>cm.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>outcome column (categorical): Post_Shared?
treatment column: Is_Male?
numerical/categorical covariates: []
text covariate: Post_Text
preprocess time:  0.015369415283203125  sec
start fitting causal inference model
time to fit causal inference model:  0.5458502769470215  sec</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;causalnlp.core.causalinference.CausalInferenceModel&gt;</code></pre>
</div>
</div>
<p>Although we have excluded the <strong>negative</strong> and <strong>positive</strong> columns as extra covariates, you can use traditional categorical/numerical covariates in combination with a text field covariate (if they exist as extra columns in the dataframe).</p>
<p>Here, we see that the same causal estimates are returned, as the text is easy to infer as positive or negative based on their correlations with the outcomes in this problem.</p>
<div id="cell-45" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ate <span class="op">=</span> cm.estimate_ate()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>ate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.05366850622769351}</code></pre>
</div>
</div>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>cm.estimate_ate(df[<span class="st">'Post_Text'</span>] <span class="op">==</span> <span class="st">'My boss is pretty terrible.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.042535751074149745}</code></pre>
</div>
</div>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cm.estimate_ate(df[<span class="st">'Post_Text'</span>] <span class="op">==</span> <span class="st">'I really love my job!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.06436468274776497}</code></pre>
</div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ate[<span class="st">'ate'</span>] <span class="op">&gt;</span> <span class="fl">0.05</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ate[<span class="st">'ate'</span>] <span class="op">&lt;</span> <span class="fl">0.055</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Make predictions on new data.  Again, make sure the DataFrame contains the relevant columns included in the original DataFrame supplied to `CausalInferenceModel.fit`:</code></pre>
<div id="cell-50" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>cm.get_required_columns()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Is_Male?', 'Post_Text']</code></pre>
</div>
</div>
<div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>     <span class="st">'Post_Text'</span> : [<span class="st">'I love my life.'</span>],</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'New Column'</span> : [<span class="dv">1</span>],</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Is_Male?'</span> : [<span class="dv">0</span>],</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'negative'</span> : [<span class="dv">0</span>]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>effect <span class="op">=</span> cm.predict(test_df)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> effect[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">&lt;</span> <span class="fl">0.065</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> effect[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">&gt;</span> <span class="fl">0.064</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.06436468]]</code></pre>
</div>
</div>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>cm.interpret(plot<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">'feature_importance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{1: v_boss        1.0
 v_terrible    0.0
 v_pretty      0.0
 dtype: float64}</code></pre>
</div>
</div>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>cm.interpret(plot<span class="op">=</span><span class="va">True</span>, method<span class="op">=</span><span class="st">'feature_importance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00a_core.causalinference_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-54" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>cm.interpret(plot<span class="op">=</span><span class="va">True</span>, method<span class="op">=</span><span class="st">'shap_values'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00a_core.causalinference_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="causal-inference-with-text-as-a-treatment" class="level3">
<h3 class="anchored" data-anchor-id="causal-inference-with-text-as-a-treatment">Causal Inference With Text as a Treatment</h3>
<p>Suppose we were interested in estimating the causal impact of <strong>sentiment</strong> on the outcome. That is, <strong>sentiment</strong> of text is the treatment, and the <strong>gender</strong> is a potential confounder. As we did above, we can use the <a href="https://amaiya.github.io/causalnlp/autocoder.html#autocoder"><code>Autocoder</code></a> to create the treatment variable. The only difference is that we would supply the <code>binarize=True</code> as an argument.</p>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> ac.code_sentiment(original_df[<span class="st">'Post_Text'</span>].values, original_df, binarize<span class="op">=</span><span class="va">True</span>, batch_size<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Is_Male?</th>
<th data-quarto-table-cell-role="th">Post_Text</th>
<th data-quarto-table-cell-role="th">Post_Shared?</th>
<th data-quarto-table-cell-role="th">negative</th>
<th data-quarto-table-cell-role="th">positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>I really love my job!</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-59" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> CausalInferenceModel(df, method<span class="op">=</span><span class="st">'t-learner'</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                          treatment_col<span class="op">=</span><span class="st">'positive'</span>, outcome_col<span class="op">=</span><span class="st">'Post_Shared?'</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                          include_cols<span class="op">=</span>[<span class="st">'Is_Male?'</span>])</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>cm.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>outcome column (categorical): Post_Shared?
treatment column: positive
numerical/categorical covariates: ['Is_Male?']
preprocess time:  0.008125543594360352  sec
start fitting causal inference model
time to fit causal inference model:  0.5112130641937256  sec</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;causalnlp.core.causalinference.CausalInferenceModel&gt;</code></pre>
</div>
</div>
<div id="cell-60" class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>ate <span class="op">=</span> cm.estimate_ate()</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>ate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'ate': 0.19008080596986368}</code></pre>
</div>
</div>
<div id="cell-61" class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ate[<span class="st">'ate'</span>] <span class="op">&gt;</span> <span class="fl">0.18</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ate[<span class="st">'ate'</span>] <span class="op">&lt;</span> <span class="fl">0.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>cm.get_required_columns()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['positive', 'Is_Male?']</code></pre>
</div>
</div>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Is_Male?'</span> : [<span class="dv">1</span>],</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'positive'</span> : [<span class="dv">1</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>effect <span class="op">=</span> cm.predict(test_df)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.20099539]]</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/amaiya\.github\.io\/causalnlp\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/amaiya/causalnlp/tree/main/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>